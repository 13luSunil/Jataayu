// Top-level build file where you can add configuration options common_build to all sub-projects/modules.

buildscript {
    ext.kotlin_version = '1.3.61'

    repositories {
        google()
        jcenter()
        gradlePluginPortal()
    }

    dependencies {
        classpath Deps.toolsAndroidStudio
        classpath Deps.toolsKotlinGradle
        classpath Deps.toolsGradleVersions
        classpath Deps.toolsJacocoCore
        classpath Deps.toolsDicemelonJacoco
        classpath 'com.palantir:jacoco-coverage:0.4.0'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        maven { url 'https://jitpack.io' }
    }
}

subprojects {
    afterEvaluate { project ->
        if (project.hasProperty('android')) {
            apply plugin: "com.github.ben-manes.versions"

            //<editor-fold desc="android common DSL">
            android {
                buildToolsVersion Config.buildToolsVersion
                compileSdkVersion Config.compileSdkVersion

                defaultConfig {
                    minSdkVersion Config.minSdkVersion
                    targetSdkVersion Config.compileSdkVersion
                }

                compileOptions {
                    sourceCompatibility Config.javaVersion
                    targetCompatibility Config.javaVersion
                }

                buildTypes {
                    debug {}
                    qa {}
                    release {}
                }

                //<editor-fold desc="Source Sets DSL">
                sourceSets {
                    main.java.srcDirs += 'src/main/java'
                    test.java.srcDirs += 'src/test/java'
                    androidTest.java.srcDirs += 'src/androidTest/java'

                    String sharedTestJavaDir = 'src/sharedTest/java'
                    String sharedTestResourcesDir = 'src/sharedTest/resources'

                    test {
                        java.srcDirs += sharedTestJavaDir
                        resources.srcDirs += sharedTestResourcesDir
                    }
                    androidTest {
                        java.srcDirs += sharedTestJavaDir
                        resources.srcDirs += sharedTestResourcesDir
                    }
                }
                //</editor-fold>

                kotlin {
                    experimental {
                        coroutines "enable"
                    }
                }
            }
        }
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}